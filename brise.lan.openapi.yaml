openapi: 3.0.4
info:
  title: Brise LAN API
  version: 3.0.0
  contact:
    name: AGST
    email: ped@agst.com.br
    url: https://www.agst.com.br
  description: |
    A **Brise LAN API** √© a interface para comunica√ß√£o direta com dispositivos Brise dentro de uma mesma rede local, sem necessidade de conex√£o com a internet.  
    Projetada para ambientes onde a lat√™ncia, confiabilidade ou seguran√ßa s√£o cr√≠ticas, ela permite o controle e monitoramento local de dispositivos Brise por meio de chamadas HTTP/HTTPS diretamente ao dispositivo na mesma rede.

    Todos os dados s√£o trocados no formato **JSON**, seguindo padr√µes RESTful, facilitando a integra√ß√£o com sistemas de automa√ß√£o residencial, industrial e predial que operam offline ou exigem resposta em tempo real.

    ### Funcionalidades Principais

    - **Comunica√ß√£o direta com dispositivos Brise** na rede local  
    - **Controle imediato** de opera√ß√µes  
    - **Leitura de status e m√©tricas em tempo real** sem intermedi√°rios  
    - **Opera√ß√£o independente do servi√ßo** ‚Äî ideal para ambientes isolados ou restritos  

    A API utiliza autentica√ß√£o simples e n√£o depende de servi√ßos externos, garantindo disponibilidade cont√≠nua mesmo sem acesso √† internet.

    ### Quando usar a Brise LAN API?

    Esta API √© recomendada nos seguintes cen√°rios:
    - Falhas frequentes ou aus√™ncia de conectividade com a internet.
    - Necessidade de baixa lat√™ncia no controle (ex: automa√ß√£o cr√≠tica).
    - Pol√≠ticas de seguran√ßa que pro√≠bem ou restringem tr√°fego via internet.

    > ‚ö†Ô∏è **Importante**: A Brise Local API opera apenas dentro da rede local. O endere√ßo IP do dispositivo ou gateway Brise deve ser conhecido e acess√≠vel pela aplica√ß√£o cliente.

    Para integra√ß√µes h√≠bridas, combine esta API com a **Brise Cloud API** e mantenha o controle local com supervis√£o remota.

    # üîê Autentica√ß√£o

    Este t√≥pico descreve os m√©todos de autentica√ß√£o dispon√≠veis e como utiliz√°-los.  

    <!-- ReDoc-Inject: <security-definitions> -->

servers:
  - url: "http://{device-ip}/api/v3"
    description: Dispositivo Brise na rede local (substitua {device-ip})

tags:
  - name: Rede
    description: Opera√ß√µes relacionadas √† configura√ß√£o e status da rede do dispositivo Brise.

paths:
  /network/status:
    get:
      tags:
        - Rede
      summary: Status de rede
      description: |
        Retorna as informa√ß√µes completas de rede do dispositivo Brise, abrangendo as interfaces:
        - **Station (STA)** ‚Äî conex√£o Wi-Fi cliente.
        - **Access Point (AP)** ‚Äî rede Wi-Fi criada pelo dispositivo.
        - **Ethernet (ETH)** ‚Äî conex√£o com fio, se dispon√≠vel.

        > Interfaces n√£o presentes no dispositivo ou desativadas **n√£o ser√£o inclu√≠das** na resposta.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Status completo de todas as interfaces de rede
          content:
            application/json:
              schema:
                type: object
                properties:
                  station:
                    type: object
                    description: Informa√ß√µes da interface Wi-Fi no modo esta√ß√£o (cliente).
                    properties:
                      ssid_station:
                        type: string
                        description: Nome da rede Wi-Fi √† qual o dispositivo est√° conectado.
                        example: "RedeBrise"
                      channel_station:
                        type: integer
                        description: Canal de opera√ß√£o da rede Wi-Fi.
                        example: 6
                      signal_station:
                        type: integer
                        description: Intensidade do sinal da rede Wi-Fi em dBm (valores negativos, quanto mais pr√≥ximo de zero, melhor).
                        example: -62
                      dhcp:
                        type: boolean
                        description: Indica se o endere√ßo IP foi obtido automaticamente via DHCP.
                        example: true
                      ip_station:
                        type: string
                        description: Endere√ßo IP atual da interface Wi-Fi (modo esta√ß√£o).
                        example: "192.168.0.105"
                      netmask_station:
                        type: string
                        description: M√°scara de rede configurada para a interface Wi-Fi.
                        example: "255.255.255.0"
                      gateway_station:
                        type: string
                        description: Endere√ßo IP do gateway configurado.
                        example: "192.168.0.1"
                      mac_station:
                        type: string
                        description: Endere√ßo MAC f√≠sico da interface Wi-Fi (modo esta√ß√£o).
                        example: "84:CC:A8:42:1F:7B"
                      dns_station:
                        type: array
                        description: Lista de servidores DNS configurados.
                        items:
                          type: string
                        example: "8.8.8.8"
                      sntp_station:
                        type: string
                        nullable: true
                        description: Endere√ßo do servidor SNTP utilizado para sincroniza√ß√£o de hor√°rio.
                        example: "pool.ntp.org"

                  ap:
                    type: object
                    description: Informa√ß√µes da interface Wi-Fi no modo ponto de acesso (AP).
                    properties:
                      ssid_ap:
                        type: string
                        description: Nome da rede Wi-Fi criada pelo dispositivo.
                        example: "Brise-Setup"
                      channel_ap:
                        type: integer
                        description: Canal de opera√ß√£o da rede Wi-Fi em modo AP.
                        example: 11
                      ip_ap:
                        type: string
                        description: Endere√ßo IP do ponto de acesso.
                        example: "192.168.4.1"
                      netmask_ap:
                        type: string
                        description: M√°scara de rede configurada para o ponto de acesso.
                        example: "255.255.255.0"
                      gateway_ap:
                        type: string
                        description: Endere√ßo IP do gateway do ponto de acesso (normalmente o pr√≥prio dispositivo).
                        example: "192.168.4.1"
                      mac_ap:
                        type: string
                        description: Endere√ßo MAC f√≠sico da interface Wi-Fi em modo AP.
                        example: "84:CC:A8:42:1F:7C"
                      dns_ap:
                        type: array
                        description: Lista de servidores DNS configurados para o ponto de acesso.
                        items:
                          type: string
                        example: "192.168.4.1"

                  eth:
                    type: object
                    description: Informa√ß√µes da interface Ethernet, se dispon√≠vel.
                    properties:
                      dhcp:
                        type: boolean
                        description: Indica se o endere√ßo IP foi obtido automaticamente via DHCP.
                        example: false
                      ip_eth:
                        type: string
                        description: Endere√ßo IP da interface Ethernet.
                        example: "192.168.0.106"
                      netmask_eth:
                        type: string
                        description: M√°scara de rede configurada para a interface Ethernet.
                        example: "255.255.255.0"
                      gateway_eth:
                        type: string
                        description: Endere√ßo IP do gateway configurado para a interface Ethernet.
                        example: "192.168.0.1"
                      mac_eth:
                        type: string
                        description: Endere√ßo MAC f√≠sico da interface Ethernet.
                        example: "84:CC:A8:42:1F:7D"
                      dns_eth:
                        type: array
                        description: Lista de servidores DNS configurados para a interface Ethernet.
                        items:
                          type: string
                        example: "8.8.8.8"
                      sntp_eth:
                        type: string
                        nullable: true
                        description: Endere√ßo do servidor SNTP utilizado para sincroniza√ß√£o de hor√°rio via Ethernet.
                        example: "pool.ntp.org"

              examples:
                exemplo_completo:
                  summary: Exemplo com todas as interfaces ativas
                  value:
                    station:
                      ssid_station: "RedeBrise"
                      channel_station: 6
                      signal_station: -62
                      dhcp: true
                      ip_station: "192.168.0.105"
                      netmask_station: "255.255.255.0"
                      gateway_station: "192.168.0.1"
                      mac_station: "84:CC:A8:42:1F:7B"
                      dns_station: "8.8.8.8"
                      sntp_station: "pool.ntp.org"
                    ap:
                      ssid_ap: "Brise-Setup"
                      channel_ap: 11
                      ip_ap: "192.168.4.1"
                      netmask_ap: "255.255.255.0"
                      gateway_ap: "192.168.4.1"
                      mac_ap: "84:CC:A8:42:1F:7C"
                      dns_ap: "192.168.4.1"
                    eth:
                      dhcp: false
                      ip_eth: "192.168.0.106"
                      netmask_eth: "255.255.255.0"
                      gateway_eth: "192.168.0.1"
                      mac_eth: "84:CC:A8:42:1F:7D"
                      dns_eth: "8.8.8.8"
                      sntp_eth: "pool.ntp.org"
        "500":
          description: Erro interno ao obter informa√ß√µes de rede
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /network/wifi:
    put:
      tags:
        - Rede
      summary: Configura Wi-Fi
      description: |
        Define o SSID e a senha da rede Wi-Fi √† qual o dispositivo Brise deve se conectar.  
        Ap√≥s a atualiza√ß√£o, o dispositivo tentar√° conectar automaticamente √† nova rede.

        > ‚ö†Ô∏è Durante o processo de troca de rede, a conex√£o atual ser√° interrompida.  
        > O dispositivo aplicar√° as novas credenciais e reiniciar√° o m√≥dulo de rede.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - ssid
                - password
              properties:
                ssid:
                  type: string
                  description: Nome da rede Wi-Fi (SSID) √† qual o dispositivo deve se conectar.
                  example: "RedeBrise"
                password:
                  type: string
                  description: Senha da rede Wi-Fi. Deve conter entre 8 e 63 caracteres para redes WPA/WPA2/WPA3.
                  example: "12345678"
      responses:
        "200":
          description: Configura√ß√£o aplicada com sucesso.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Indica se a configura√ß√£o foi aplicada corretamente.
                    example: true
              examples:
                sucesso:
                  summary: Exemplo de sucesso
                  value:
                    success: true
        "400":
          description: Requisi√ß√£o inv√°lida. Verifique os dados enviados.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    get:
      tags:
        - Rede
      summary: Lista redes Wi-Fi
      description: |
        Retorna a lista mais recente de redes Wi-Fi detectadas pelo dispositivo.  
        O dispositivo executa varreduras autom√°ticas periodicamente (a cada 30 segundos), mantendo a lista atualizada em cache.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Lista de redes encontradas.
          content:
            application/json:
              schema:
                type: object
                properties:
                  last_scan:
                    type: string
                    format: date-time
                    description: Data e hora da √∫ltima varredura conclu√≠da com sucesso (UTC).
                    example: "2025-10-31T10:22:15Z"
                  networks:
                    type: array
                    description: Lista de redes Wi-Fi detectadas durante a √∫ltima varredura.
                    items:
                      type: object
                      properties:
                        ssid:
                          type: string
                          description: Nome (SSID) da rede detectada.
                          example: "RedeBrise"
                        rssi:
                          type: integer
                          description: Intensidade do sinal em dBm. Valores mais negativos indicam sinal mais fraco.
                          example: -62
                        security:
                          type: string
                          description: "Tipo de seguran√ßa da rede (ex: `WPA2`, `WPA3`, `Open`)."
                          example: "WPA2"
                        channel:
                          type: integer
                          description: Canal Wi-Fi no qual a rede foi detectada.
                          example: 6
              examples:
                exemplo:
                  summary: Exemplo de resposta
                  value:
                    last_scan: "2025-10-31T10:22:15Z"
                    networks:
                      - ssid: "RedeBrise"
                        rssi: -62
                        security: "WPA2"
                        channel: 6
                      - ssid: "RedeAGST"
                        rssi: -78
                        security: "WPA3"
                        channel: 11

  /network/wifi/scan:
    post:
      tags:
        - Rede
      summary: Scan Wi-Fi
      description: |
        Solicita ao dispositivo que execute imediatamente uma nova varredura Wi-Fi, atualizando o cache de redes observadas.  

        > üïí A opera√ß√£o √© ass√≠ncrona: a lista pode levar alguns segundos para refletir as novas redes detectadas.  
        > Use `GET /network/wifi` para verificar quando o cache for atualizado.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Varredura iniciada com sucesso.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Indica se a solicita√ß√£o foi aceita.
                    example: true
                  started_at:
                    type: string
                    format: date-time
                    description: Data e hora de in√≠cio da varredura (UTC).
                    example: "2025-10-31T10:21:00Z"
              examples:
                sucesso:
                  summary: Exemplo de sucesso
                  value:
                    success: true
                    started_at: "2025-10-31T10:21:00Z"
        "409":
          description: J√° existe uma varredura em andamento.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: C√≥digo do erro indicando que uma opera√ß√£o de varredura j√° est√° em execu√ß√£o.
                    example: ALREADY_IN_PROGRESS

components:
  securitySchemes:
    bearerAuth:
      title: Bearer Authentication
      type: http
      scheme: bearer
      description: |
        O token de acesso deve ser enviado no cabe√ßalho `Authorization` da sua requisi√ß√£o autenticada.

        ```
        Authorization: Bearer <seu-token>
        ```
  schemas:
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: C√≥digo de erro representando o tipo de falha da requisi√ß√£o.
          example: INVALID_REQUEST
